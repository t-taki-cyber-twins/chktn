# カスタムロールグループ管理画面 (custom-role-group.html)

## 概要
各テナントが独自のロールグループを作成し、マスタロールやマスタロールグループから権限を選択・組み合わせてカスタマイズするための管理画面です。

## 機能の目的
- テナントごとの業務や組織構造に合わせた、独自のロールグループを定義できるようにする。
- マスタロールやロールグループを基盤として、権限を柔軟に組み合わせたカスタマイズを実現する。
- 役職や業務内容に応じた細かい権限管理を可能にする。

## ユースケース
- **独自役職の権限設定**: テナント管理者は、自社独自の役職（例:「個人情報閲覧できるエンジニア管理者」）に必要な権限を設定する。
- **権限の組み合わせ**: テナント管理者は、複数のマスタロールを組み合わせて、新しいカスタムロールグループを作成する。
- **マスタロールグループからの追加**: テナント管理者は、既存のマスタロールグループをベースに、追加の権限を付与したカスタムロールグループを作成する。
- **権限の詳細確認**: テナント管理者は、特定のカスタムロールグループが持つ権限を一覧で確認する。
- **不要な権限の削除**: テナント管理者は、カスタムロールグループから不要な権限を削除し、必要最小限の権限に調整する。

## EARS 記法による要件定義

### カスタムロールグループ検索・一覧表示
- **WHEN** テナント管理者がカスタムロールグループ管理画面を開いた際
  - **THEN** システムは自テナントのカスタムロールグループを一覧表示する
  - **AND** ID、カスタムロールグループ名、説明、作成日を表示する

- **WHEN** テナント管理者がカスタムロールグループ名で検索を実行した際
  - **THEN** システムは検索条件に一致するカスタムロールグループのみをフィルタリングして表示する
  - **IF** 「検索条件を記憶する」がチェックされている場合
    - **THEN** システムは検索条件を保存し、次回アクセス時に復元する

### カスタムロールグループCRUD操作
- **WHEN** テナント管理者が「新規作成」ボタンをクリックした際
  - **THEN** システムはカスタムロールグループ作成フォームを表示する
  - **AND** カスタムロールグループ名、説明の入力を受け付ける

- **WHEN** テナント管理者が「編集」ボタンをクリックした際
  - **THEN** システムは権限管理モーダルを開く
  - **AND** 該当するカスタムロールグループが持つすべての権限を一覧表示する

- **WHEN** テナント管理者が「削除」ボタンをクリックした際
  - **THEN** システムは確認ダイアログを表示する
  - **IF** 管理者が削除を確認した場合
    - **AND IF** 該当カスタムロールグループが社員に割り当てられている場合
      - **THEN** システムは警告メッセージを表示し、削除の影響を確認する
    - **ELSE**
      - **THEN** システムはカスタムロールグループを削除する

### 権限管理（モーダル）

#### 権限一覧表示
- **WHEN** テナント管理者が権限管理モーダルを開いた際
  - **THEN** システムは該当するカスタムロールグループに紐づくすべての権限を表示する
  - **AND** 権限ID、権限名、権限コードを表示する

#### 権限追加
- **WHEN** テナント管理者が「権限から追加」ボタンをクリックした際
  - **THEN** システムは権限選択フォームを表示する
  - **AND** 利用可能な権限の一覧を表示する

- **WHEN** テナント管理者が「ロールから追加」ボタンをクリックした際
  - **THEN** システムはマスタロール選択フォームを表示する
  - **AND** 選択されたマスタロールが持つすべての権限をカスタムロールグループに追加する

- **WHEN** テナント管理者が「ロールグループから追加」ボタンをクリックした際
  - **THEN** システムはマスタロールグループ選択フォームを表示する
  - **AND** 選択されたマスタロールグループが持つすべての権限をカスタムロールグループに追加する

- **WHEN** テナント管理者が権限を追加する際
  - **IF** 同じ権限が既に存在する場合
    - **THEN** システムは重複登録をスキップする（エラーにはしない）
  - **ELSE**
    - **THEN** システムは新しい権限を追加する

#### 権限削除
- **WHEN** テナント管理者が権限の「削除」ボタンをクリックした際
  - **THEN** システムは確認ダイアログを表示する
  - **IF** 管理者が削除を確認した場合
    - **THEN** システムは該当する権限をカスタムロールグループから削除する

## 機能一覧

| 画面 | 機能名 | 概要 | 優先度 | アクター | 備考 |
|---|---|---|---|---|---|
| カスタムロールグループ管理 | 検索 | カスタムロールグループ名で検索する | 必須 | テナント管理者 | |
| カスタムロールグループ管理 | 検索条件記憶 | 「検索条件を記憶します」がONの場合、検索条件を保存する | 推奨 | システム | localStorageで実装予定 |
| カスタムロールグループ管理 | 一覧表示 | 自テナントのカスタムロールグループをテーブル形式で表示する | 必須 | システム | |
| カスタムロールグループ管理 | 新規作成 | 新しいカスタムロールグループを作成する | 必須 | テナント管理者 | 作成フォームの実装方法要確認 |
| カスタムロールグループ管理 | 編集（権限管理モーダル表示） | 権限管理モーダルを開く | 必須 | テナント管理者 | |
| カスタムロールグループ管理 | 削除 | カスタムロールグループを削除する | 必須 | テナント管理者 | 社員紐づけチェックと確認ダイアログ |
| カスタムロールグループ管理 | ページネーション | ページ切り替えを行う | 必須 | テナント管理者 | `app-pagination`コンポーネントを使用 |
| 権限管理（モーダル） | 権限一覧表示 | カスタムロールグループが持つすべての権限を表示する | 必須 | システム | |
| 権限管理（モーダル） | 権限から追加 | 個別の権限を選択して追加する | 必須 | テナント管理者 | 追加フォームの実装方法要確認 |
| 権限管理（モーダル） | ロールから追加 | マスタロールが持つ権限をまとめて追加する | 必須 | テナント管理者 | マスタロール選択フォームの実装方法要確認 |
| 権限管理（モーダル） | ロールグループから追加 | マスタロールグループが持つ権限をまとめて追加する | 必須 | テナント管理者 | マスタロールグループ選択フォームの実装方法要確認 |
| 権限管理（モーダル） | 権限削除 | カスタムロールグループから権限を削除する | 必須 | テナント管理者 | 確認ダイアログ |

## ユーザ確認事項
- **権限の粒度**: 権限コード（例: `engineer.show`, `engineer.personal_info_show`）の定義や、どの程度細かく権限を分割するかの確認が必要です。
- **権限マスタの管理**: 個別の権限（permission）は別途マスタとして管理されているのか、またはシステムで固定的に定義されているのかの確認が必要です。
- **マスタロールとの関係**: カスタムロールグループに追加できる権限は、マスタロールやマスタロールグループに含まれる権限のみか、それともシステム全体の権限から自由に選択できるかの確認が必要です。
- **カスタムロールグループの共有**: 作成したカスタムロールグループは自テナント内でのみ使用可能か、他テナントとも共有できるかの確認が必要です。
- **削除時の社員紐づけ**: カスタムロールグループを削除した際、紐づいていた社員の権限はどうなるか（デフォルトのロールグループに戻すか、権限なしになるか）の確認が必要です。
- **フォームの実装方法**: カスタムロールグループ作成フォーム、権限追加フォーム、ロール選択フォームをモーダル、別画面、インライン編集のいずれで実装するか確認が必要です。
- **ページネーション仕様**: 1ページあたりの表示件数や、サーバーサイドページネーションの実装方法について確認が必要です。
