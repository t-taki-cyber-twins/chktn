# ロール管理画面 (master-role.html)

## 概要
システム全体で使用するマスタロール、マスタロールグループ、およびそれらの紐づけを管理する画面です。3つのタブで構成され、権限管理の基礎となるマスタデータを一元管理します。

## 機能の目的
- システム全体で使用する標準的なロール（権限）とロールグループを定義・管理する。
- ロールとロールグループの紐づけを明確にし、権限の組み合わせを管理する。
- テナントがカスタムロールグループを作成する際の基礎となるマスタデータを提供する。

## ユースケース
- **新規ロールの追加**: システム管理者は、新しい権限種別が必要になった際に、マスタロールを追加する。
- **ロールグループの作成**: システム管理者は、複数のロールを組み合わせた役職（ロールグループ）を定義する。
- **権限の紐づけ確認**: システム管理者は、特定のロールグループがどのロールを持っているかを確認する。
- **ロールの編集・削除**: システム管理者は、既存のロールやロールグループの情報を更新または削除する。
- **ロールグループへのロール追加**: システム管理者は、既存のロールグループに新しいロールを追加する。

## EARS 記法による要件定義

### タブ1: マスタロール管理

#### ロール検索・一覧表示
- **WHEN** システム管理者が「マスタロール管理」タブを開いた際
  - **THEN** システムはすべてのマスタロールを一覧表示する
  - **AND** ID、ロール名、説明を表示する

- **WHEN** システム管理者がロール名で検索を実行した際
  - **THEN** システムは検索条件に一致するロールのみをフィルタリングして表示する

#### ロールCRUD操作
- **WHEN** システム管理者が「新規作成」ボタンをクリックした際
  - **THEN** システムはロール作成フォームを表示する
  - **AND** ロールID、ロール名、説明の入力を受け付ける

- **WHEN** システム管理者が「編集」ボタンをクリックした際
  - **THEN** システムは該当するロールの編集フォームを表示する
  - **AND** 既存のロール情報をフォームにロードする

- **WHEN** システム管理者が「削除」ボタンをクリックした際
  - **THEN** システムは確認ダイアログを表示する
  - **IF** 管理者が削除を確認した場合
    - **AND IF** 該当ロールがロールグループに紐づいている場合
      - **THEN** システムはエラーメッセージを表示し、削除を拒否する
    - **ELSE**
      - **THEN** システムはロールを削除する

### タブ2: マスタロールグループ管理

#### ロールグループ検索・一覧表示
- **WHEN** システム管理者が「マスタロールグループ管理」タブを開いた際
  - **THEN** システムはすべてのマスタロールグループを一覧表示する
  - **AND** ID、ロールグループ名、説明を表示する

- **WHEN** システム管理者がロールグループ名で検索を実行した際
  - **THEN** システムは検索条件に一致するロールグループのみをフィルタリングして表示する

#### ロールグループCRUD操作
- **WHEN** システム管理者が「新規作成」ボタンをクリックした際
  - **THEN** システムはロールグループ作成フォームを表示する
  - **AND** ロールグループID、ロールグループ名、説明の入力を受け付ける

- **WHEN** システム管理者が「編集」ボタンをクリックした際
  - **THEN** システムは該当するロールグループの編集フォームを表示する
  - **AND** 既存のロールグループ情報をフォームにロードする

- **WHEN** システム管理者が「削除」ボタンをクリックした際
  - **THEN** システムは確認ダイアログを表示する
  - **IF** 管理者が削除を確認した場合
    - **AND IF** 該当ロールグループにロールが紐づいている場合
      - **THEN** システムはエラーメッセージを表示し、削除を拒否する
    - **ELSE**
      - **THEN** システムはロールグループを削除する

### タブ3: マスタロールグループロール管理

#### ロールグループロール紐づけ検索・一覧表示
- **WHEN** システム管理者が「マスタロールグループロール管理」タブを開いた際
  - **THEN** システムはすべてのロールグループとロールの紐づけを一覧表示する
  - **AND** ロールグループID、ロールグループ名、ロールID、ロール名を表示する

- **WHEN** システム管理者がロールグループで絞り込みを実行した際
  - **THEN** システムは選択されたロールグループに紐づくロールのみを表示する

#### ロールグループロール紐づけ操作
- **WHEN** システム管理者が「新規紐づけ」ボタンをクリックした際
  - **THEN** システムは紐づけ作成フォームを表示する
  - **AND** ロールグループ選択、ロール選択の入力を受け付ける

- **WHEN** システム管理者が紐づけを保存する際
  - **IF** 同じロールグループとロールの組み合わせが既に存在する場合
    - **THEN** システムはエラーメッセージを表示し、重複登録を拒否する
  - **ELSE**
    - **THEN** システムは新しい紐づけを作成する

- **WHEN** システム管理者が「削除」ボタンをクリックした際
  - **THEN** システムは確認ダイアログを表示する
  - **IF** 管理者が削除を確認した場合
    - **THEN** システムは該当する紐づけを削除する

### 共通機能

#### タブ切り替え
- **WHEN** システム管理者がタブボタンをクリックした際
  - **THEN** システムは該当するタブの内容を表示する
  - **AND** サイドバーの検索フォームも該当するタブ用のものに切り替える
  - **AND** アクティブなタブを視覚的に強調表示する

## 機能一覧

| 画面 | 機能名 | 概要 | 優先度 | アクター | 備考 |
|---|---|---|---|---|---|
| ロール管理（タブ1） | ロール検索 | ロール名で検索する | 必須 | システム管理者 | |
| ロール管理（タブ1） | ロール一覧表示 | すべてのロールをテーブル形式で表示する | 必須 | システム | ID、ロール名、説明を表示 |
| ロール管理（タブ1） | ロール新規作成 | 新しいロールを作成する | 必須 | システム管理者 | 作成フォームの実装方法要確認 |
| ロール管理（タブ1） | ロール編集 | 既存ロールの情報を編集する | 必須 | システム管理者 | 編集フォームの実装方法要確認 |
| ロール管理（タブ1） | ロール削除 | ロールを削除する | 必須 | システム管理者 | 紐づけチェックと確認ダイアログ |
| ロール管理（タブ1） | ページネーション | ページ切り替えを行う | 必須 | システム管理者 | `app-pagination`コンポーネントを使用 |
| ロール管理（タブ2） | ロールグループ検索 | ロールグループ名で検索する | 必須 | システム管理者 | |
| ロール管理（タブ2） | ロールグループ一覧表示 | すべてのロールグループをテーブル形式で表示する | 必須 | システム | ID、ロールグループ名、説明を表示 |
| ロール管理（タブ2） | ロールグループ新規作成 | 新しいロールグループを作成する | 必須 | システム管理者 | 作成フォームの実装方法要確認 |
| ロール管理（タブ2） | ロールグループ編集 | 既存ロールグループの情報を編集する | 必須 | システム管理者 | 編集フォームの実装方法要確認 |
| ロール管理（タブ2） | ロールグループ削除 | ロールグループを削除する | 必須 | システム管理者 | 紐づけチェックと確認ダイアログ |
| ロール管理（タブ2） | ページネーション | ページ切り替えを行う | 必須 | システム管理者 | `app-pagination`コンポーネントを使用 |
| ロール管理（タブ3） | ロールグループフィルタ | ロールグループで絞り込む | 必須 | システム管理者 | |
| ロール管理（タブ3） | 紐づけ一覧表示 | すべての紐づけをテーブル形式で表示する | 必須 | システム | ロールグループID、名、ロールID、名を表示 |
| ロール管理（タブ3） | 新規紐づけ作成 | ロールグループにロールを紐づける | 必須 | システム管理者 | 重複チェック、作成フォームの実装方法要確認 |
| ロール管理（タブ3） | 紐づけ削除 | ロールグループとロールの紐づけを削除する | 必須 | システム管理者 | 確認ダイアログ |
| ロール管理（タブ3） | ページネーション | ページ切り替えを行う | 必須 | システム管理者 | `app-pagination`コンポーネントを使用 |
| ロール管理（共通） | タブ切り替え | 3つのタブ間で切り替える | 必須 | システム管理者 | サイドバー検索フォームも連動 |

## ユーザ確認事項
- **フォームの実装方法**: ロール、ロールグループの作成・編集フォームをモーダル、別画面、インライン編集のいずれで実装するか確認が必要です。
- **削除時の依存関係チェック**: ロール削除時にロールグループに紐づいている場合のエラー処理、ロールグループ削除時にロールが紐づいている場合のエラー処理について、具体的な挙動を確認が必要です。
- **ロールIDの採番方法**: ロールIDは手動で入力するか、システムが自動採番するかの確認が必要です。現在のHTMLではIDが表示されていることから手動の可能性があります。
- **カスタムロールとの関係**: マスタロールとテナント独自のカスタムロール（`custom-role-group.html`で管理）との関係や、マスタロールがカスタムロールグループで使用される仕組みについて確認が必要です。
- **ロールの権限範囲**: 各ロール（エンジニア管理者、エンジニア編集者、エンジニア閲覧者等）が具体的にどの画面・機能にアクセスできるかの権限マトリックスの確認が必要です。
- **ページネーション仕様**: 各タブで1ページあたりの表示件数や、サーバーサイドページネーションの実装方法について確認が必要です。
