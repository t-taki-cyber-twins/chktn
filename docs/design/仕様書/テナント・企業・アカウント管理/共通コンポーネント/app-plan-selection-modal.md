# プラン選択モーダル (app-plan-selection-modal.js)

## 概要
テナントの契約プランとオプション（アドオン）機能を選択・変更するためのモーダルコンポーネントです。

## 機能の目的
- テナントのニーズに合わせて、適切な機能セット（プラン）を選択できるようにする。
- 追加機能（アドオン）のオンデマンドな契約を可能にする。
- 従量課金プラン（APIプラン）などの特殊な契約形態にも対応する。

## ユースケース
- **プラン変更**: ユーザーは、事業拡大に伴い「エンジニア提供プラン」から「ダブルプラン」へアップグレードする。
- **オプション追加**: ユーザーは、業務効率化のために「請求書・発注書自動機能」アドオンを追加契約する。
- **API利用設定**: ユーザーは、自社システム連携のためにAPIプランを選択し、予算超過を防ぐために月額上限を設定する。

## EARS 記法による要件定義

### プラン選択
- **WHEN** モーダルが表示された際
  - **THEN** システムは利用可能な基本プラン（エンジニア提供、案件提供、ダブル、API）を一覧表示する
  - **AND** 利用可能なアドオン（AIマッチング、勤怠管理、請求書自動化）を一覧表示する

- **WHEN** ユーザーが基本プランのカードをクリックした際
  - **THEN** システムはクリックされたプランを選択状態にする（排他選択）
  - **IF** 「API従量課金プラン」が選択された場合
    - **THEN** システムは月額上限設定フィールドを表示する

### アドオン選択
- **WHEN** ユーザーがアドオンのチェックボックスをクリックした際
  - **THEN** システムは選択状態を切り替える（複数選択可）

### 保存処理
- **WHEN** ユーザーが「変更を保存」ボタンをクリックした際
  - **THEN** システムは選択されたプランとアドオン情報を保存する
  - **AND** 契約変更処理を実行する（即時反映または次回更新時反映）

## 機能一覧

| 機能名 | 概要 | 優先度 | アクター | 備考 |
|---|---|---|---|---|
| 基本プラン選択 | 契約する基本プランを選択する | 必須 | ユーザー | 排他選択 |
| アドオン選択 | 追加オプション機能を選択する | 必須 | ユーザー | 複数選択可 |
| API上限設定 | APIプラン選択時に月額利用上限金額を設定する | 必須 | ユーザー | APIプラン選択時のみ表示 |
| 保存 | 契約変更内容を確定する | 必須 | ユーザー | |

## ユーザ確認事項
- **契約変更の適用タイミング**: プラン変更が即時適用されるか、翌月適用されるか、日割り計算が行われるか等の課金ルールについて確認が必要です。
- **ダウングレード時の挙動**: 上位プランから下位プランへ変更する場合、使用できなくなる機能やデータ（例：登録可能数超過分）の扱いについて確認が必要です。
